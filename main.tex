%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SUTD Masters/Doctoral Thesis
% LaTeX Template
% Version 1.0 (29/08/16)
%
% Adapted to SUTD requirements by Martin Ochoa
%
% This template is based on a template downloaded from:
% http://www.LaTeXTemplates.com
%
% Version 2.x major modifications by:
% Vel (vel@latextemplates.com)
%
% which in turn was based on a template by:
% Steve Gunn (http://users.ecs.soton.ac.uk/srg/softwaretools/document/templates/)
% Sunil Patel (http://www.sunilpatel.co.uk/thesis-template/)
%
%
% Template license:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[
11pt, % The default document font size, options: 10pt, 11pt, 12pt
oneside, % Two side (alternating margins) for binding by default, uncomment to switch to one side
english, % ngerman for German
singlespacing, % Single line spacing, alternatives: onehalfspacing or doublespacing
%draft, % Uncomment to enable draft mode (no pictures, no links, overfull hboxes indicated)
%nolistspacing, % If the document is onehalfspacing or doublespacing, uncomment this to set spacing in lists to single
%liststotoc, % Uncomment to add the list of figures/tables/etc to the table of contents
%toctotoc, % Uncomment to add the main table of contents to the table of contents
%parskip, % Uncomment to add space between paragraphs
%nohyperref, % Uncomment to not load the hyperref package
headsepline, % Uncomment to get a line under the header
]{MastersDoctoralThesis} % The class file specifying the document structure

\usepackage[utf8]{inputenc} % Required for inputting international characters
\usepackage[T1]{fontenc} % Output font encoding for international characters

\usepackage{palatino} % Use the Palatino font by default

\usepackage[backend=bibtex,style=authoryear,natbib=true]{biblatex} % User the 
%bibtex backend with the authoryear citation style (which resembles APA)

\addbibresource{biblio.bib} % The filename of the bibliography

\usepackage[autostyle=true]{csquotes} % Required to generate language-dependent 
%quotes in the bibliography


\newcommand{\circled[1]}{\tikz[baseline=(char.base)]{\node[font=\sffamily, 
		shape=circle,draw,inner sep=0.5pt,color=white,fill=black] (char) {#1};}}
	
\newcommand{\circledr[1]}{\tikz[baseline=(char.base)]{\node[font=\sffamily, 
		shape=circle,draw,inner sep=0.5pt,color=white,fill=red] (char) {#1};}}
	
\newcommand{\circledrA}[1]{\tikz[baseline=(char.base)]{\node[font=\sffamily, 
		shape=circle,draw,inner sep=0.5pt,color=white,fill=red] (char) {#1};}}

\usepackage{subcaption}

\hypersetup{%
	colorlinks = true,
	linkcolor  = black
}

\usepackage{tikz}
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) 
-- cycle;} 
\usepackage{subcaption}
\usepackage{listings}

\usepackage[inline]{enumitem}
\usepackage{amsmath}

\usepackage{rotating}

\usepackage{graphics}

\usepackage{multirow}

\usepackage{adjustbox}
\usepackage{blindtext}

\usepackage[ruled,vlined,linesnumbered]{algorithm2e}

\definecolor{mGreen}{rgb}{0,0.6,0}
\definecolor{mGray}{rgb}{0.5,0.5,0.5}
\definecolor{mPurple}{rgb}{0.58,0,0.82}
\definecolor{backgroundColour}{rgb}{0.99,0.99,0.99}

\usepackage{ifthen}
\newcommand{\fix}[1]{
	\ifthenelse%
	{\boolean{showcomments}}%
	{\textcolor{red}{#1}}%
	{}%
}

\lstdefinestyle{CStyle}{
	backgroundcolor=\color{backgroundColour},   
	commentstyle=\color{mGreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{mGray},
	stringstyle=\color{mPurple},
	%	basicstyle=\footnotesize,
	basicstyle=\small, %or \tiny \small or \footnotesize etc.
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2,
	xleftmargin=2em,
	framexleftmargin=1.5em,
	language=C
}
\usepackage[titletoc, toc, page]{appendix}

%\usepackage[symbol]{footmisc}
%\renewcommand{\thefootnote}{\fnsymbol{footnote}}

%\makeatletter
%\def\@xfootnote[#1]{%
%	\protected@xdef\@thefnmark{#1}%
%	\@footnotemark\@footnotetext}
%\makeatother

%\long\def\symbolfootnote[#1]#2{\begingroup%
%\def\thefootnote{\fnsymbol{footnote}}\footnotetext[#1]{#2}\footnotemark[#1]\endgroup}

\makeatletter
\newcommand\footnoteref[1]{\protected@xdef\@thefnmark{\ref{#1}}\@footnotemark}
\makeatother

\makeatletter
\def\@xfootnote[#1]{%
	\protected@xdef\@thefnmark{#1}%
	\@footnotemark\@footnotetext}
\makeatother


%----------------------------------------------------------------------------------------
%	MARGIN SETTINGS
%----------------------------------------------------------------------------------------

\geometry{
	paper=a4paper, % Change to letterpaper for US letter
	inner=2.54cm, % Inner margin
	outer=2.8cm, % Outer margin
	bindingoffset=1cm, % Binding offset
	top=2.5cm, % Top margin
	bottom=2.5cm, % Bottom margin
	%showframe,% show how the type block is set on the page
}

%----------------------------------------------------------------------------------------
%	THESIS INFORMATION
%----------------------------------------------------------------------------------------

%\thesistitle{Faith in the Cloud!\\Modern and future challenges for Trusted 
%Execution Environments}
%\thesistitle{Modern challenges, future threats, and novel defenses
%	\\for Trusted Execution Environments}
\thesistitle{Challenges, threats, and novel defences for Trusted Execution 
Environments}

%Ah beer. The cause of and the solution to all of lifeâ€™s problems.

%The goal of this thesis is to investigate the current limitations of TEE, 
%grasping the future for possible new threats, and study suitable solutions 
%that could be deployed over current technology.

% Your thesis title, this is used in the title and abstract, print it elsewhere 
%with \ttitle
\supervisor{Prof. Zhou \textsc{Jianying}} % Your supervisor's name, this is 
%used in the title page, print it elsewhere with \supname
\examiner{} % Your examiner's name, this is not currently used anywhere in the template, print it elsewhere with \examname
\degree{Doctor of Philosophy} % Your degree name, this is used in the title page and abstract, print it elsewhere with \degreename
\author{Flavio \textsc{Toffalini}} % Your name, this is used in the title page 
%and abstract, print it elsewhere with \authorname
\addresses{} % Your address, this is not currently used anywhere in the template, print it elsewhere with \addressname
\university	{SUTD}
\keywords{} % Keywords for your thesis, this is not currently used anywhere in the template, print it elsewhere with \keywordnames
\pillar{ISTD} % Pillar

\hypersetup{pdftitle=\ttitle} % Set the PDF's title to your title
\hypersetup{pdfauthor=\authorname} % Set the PDF's author to your name
\hypersetup{pdfkeywords=\keywordnames} % Set the PDF's keywords to your keywords

% Define some commands to keep the formatting separated from the content 
\newcommand{\keyword}[1]{\textbf{#1}}
\newcommand{\tabhead}[1]{\textbf{#1}}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\file}[1]{\texttt{\bfseries#1}}
\newcommand{\option}[1]{\texttt{\itshape#1}}

\newcommand{\ie}{\textit{i.e.,} }
\newcommand{\eg}{\textit{e.g.,} }
\newcommand{\wrt}{\textit{w.r.t.\ }}

\newcommand{\todobox}[3]{%
	\colorbox{#1}{\textcolor{white}{\sffamily\bfseries\scriptsize #2}}%
	~\textcolor{blue}{#3} %
	\textcolor{#1}{$\triangleleft$}%
}
\newcommand{\todo}[1]{\todobox{red}{TODO}{#1}}
\newcommand{\feedback}[1]{\todobox{orange}{OK?}{#1}}
\newcommand{\done}[1]{\todobox{blue}{DONE}{#1}}
\newcommand{\rationale}[1]{\todobox{ForestGreen}{RATIONALE}{#1}}



\begin{document}

\frontmatter % Use roman page numbering style (i, ii, iii, iv...) for the pre-content pages

\pagestyle{plain} % Default to the plain heading style until the thesis style is called for the body content

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\begin{titlepage}
\begin{center}

\begin{figure}
\centering
\includegraphics[width=0.5\textwidth]{Figures/SUTD}
\end{figure}

 \hfill\break\\[2.3cm]

{\huge \bfseries \ttitle}\\[3cm] % Thesis title


Submitted by\\[1cm]
\authorname % Author name - remove the \href bracket to remove the link

\vspace{4em}

Thesis Advisor\\[1cm]
\supname % Supervisor name - remove the \href bracket to remove the link

\vspace{4em}

\pillarname\\[1.5cm] % Research group name and department name

\large{A thesis submitted to the Singapore University of Technology and Design in fulfillment of the requirement for the degree of \degreename}\\[1cm] % University requirement text


{\large \the\year}\\[4cm] % Date
%\includegraphics{Logo} % University/department logo - uncomment to place it

\vfill
\end{center}
\end{titlepage}

%----------------------------------------------------------------------------------------
%	DECLARATION PAGE
%----------------------------------------------------------------------------------------

\begin{tec}
\addchaptertocentry{\tecname}
\begin{tabular}{ll}
	TEC Chair: & Prof. Lu Wei \\
	Main Advisor: & Prof. Zhou Jianying \\
	Co-advisor: & Prof. Mauro Conti (University of Padua) \\
	Co-advisor: & Prof. Lorenzo Cavallaro (King's College London) \\
	Internal TEC member 1: & Prof. Sudipta Chattopadhyay \\
	Internal TEC member 2: & Prof. Dinh Tien Tuan Anh \\
%	External TEC member 1: & Prof. XXXX (optional) \\
%	External TEC member 2: & Prof. XXXX (optional) \\
\end{tabular}
\end{tec}
\vfill\eject

%----------------------------------------------------------------------------------------
%	DECLARATION PAGE
%----------------------------------------------------------------------------------------

% \begin{declaration}
% \addchaptertocentry{\authorshipname}

% \noindent I, \authorname, declare that this thesis titled, \enquote{\ttitle} and the work presented in it are my own. I confirm that:
%
% \begin{itemize}
% \item This work was done wholly or mainly while in candidature for a research degree at this University.
% \item Where any part of this thesis has previously been submitted for a degree or any other qualification at this University or any other institution, this has been clearly stated.
% \item Where I have consulted the published work of others, this is always clearly attributed.
% \item Where I have quoted from the work of others, the source is always given. With the exception of such quotations, this thesis is entirely my own work.
% \item I have acknowledged all main sources of help.
% \item Where the thesis is based on work done by myself jointly with others, I have made clear exactly what was done by others and what I have contributed myself.\\
% \end{itemize}

% I hereby confirm the following:
% \begin{itemize}
% \item I hereby confirm that the thesis work is original and has not been submitted to any other University or Institution for higher degree purposes.
% \item I hereby grant SUTD the permission to reproduce and distribute publicly paper and electronic copies of this thesis document in whole or in part in any medium now known or hereafter created in accordance with Policy on Intellectual Property, clause 4.2.2.
% \item I have fulfilled all requirements as prescribed by the University and provided 1 copy of my thesis in PDF.
% \item I have attached all publications and award list related to the thesis (e.g. journal, conference report and patent).
% \item The thesis does / does not (delete accordingly) contain patentable or confidential information.
% \item I certify that the thesis has been checked for plagiarism via turnitin/ithenticate. The score is 100\%.
% \end{itemize}

% \noindent Name and signature:\\
% \rule[0.5em]{25em}{0.5pt} % This prints a line for the signature

% \noindent Date:\\
% \rule[0.5em]{25em}{0.5pt} % This prints a line to write the date
% \end{declaration}

% \cleardoublepage

%----------------------------------------------------------------------------------------
%	QUOTATION PAGE
%----------------------------------------------------------------------------------------

% Uncomment for quotation page
% \vspace*{0.2\textheight}
%
% \noindent\enquote{\itshape Thanks to my solid academic training, today I can 
%write hundreds of words on virtually any topic without possessing a shred of 
%information, which is how I got a good job in journalism.}\bigbreak
%
% \hfill Dave Barry

%----------------------------------------------------------------------------------------
%	ABSTRACT PAGE
%----------------------------------------------------------------------------------------

\begin{abstract}
\addchaptertocentry{\abstractname} % Add the abstract to the table of contents

Are you sure the last Virtual Machine bought from your Cloud Provider is 
working properly?
The growing popularity of cloud infrastructures allowed online businesses
to benefit of larger market segments, parallelly, armies of adversaries enjoyed 
a vaster set of possible victims.
Additionally, leaving part of the infrastructure on cloud providers de facto 
reduced the companies control over their products, eventually increasing the 
attack surface to either insider and external threats.
This arises the need of advanced protections for the companies' products and 
data.

In this zero trust scenario, a common countermeasure is represented by Trusted 
Execution Environments (TEE). These technologies use hardware mechanisms to 
create \emph{trusted regions} shielded against fully compromised 
systems, thus allowing the companies to protect their assets even if the whole 
data center is compromised.
Specifically, \emph{trusted regions} achieve this goal through 
two properties: \emph{memory isolation} and \emph{remote attestation}.
The former ensures physical isolation of \emph{trusted regions}, thus avoiding 
direct writing to, and reading from, the protected memory pages.
The latter, instead, enables a remote entity to verify the integrity of a 
\emph{trusted region}.

The combination of \emph{memory isolation} and \emph{remote attestation} 
is a solid base for building more secure applications over the Internet. 
TEEs, however, are far from being the final weapons in the security war.
In fact, they suffer from many limitations that range from scalability 
issues to new security threats.
The goal of this thesis is to investigate the current limitations of TEE, 
grasping the future for possible new threats, and study suitable solutions that 
could be deployed over current technology.
In particular, we discuss five contributions: three regarding \emph{memory 
isolation}, and two about \emph{remote attestation}.

The first part of the thesis revolves around \emph{memory isolation}.
We address limitations affecting TEEs and propose more flexible designs fitting 
the current market products (Chapter~\ref{chp:static-protection}).
Then, we investigate new threats that exploit the \emph{memory isolation} 
and implant malicious software in a \emph{trusted region} 
(Chapter~\ref{chp:advanced-threats}).
Finally, we study the implication of (compromised) \emph{trusted regions} when 
performing incident response, and propose new techniques to fulfill the current 
gaps (Chapter~\ref{chp:forensic}).

In the second part, we extend the \emph{remote attestation} schemes to 
identify the runtime attacks described in Chapter~\ref{chp:advanced-threats}.
First, we propose a novel model that can be used in software of any complexity, 
thus overcoming the scalability issues of current approaches.
(Chapter~\ref{chp:runtime-protection-untrusted}).
Then, we propose an additional model that fits \emph{trusted regions}'
specifications, thus stretching the runtime protection over memory 
isolated objects (Chapter~\ref{chp:runtime-protection-trusted}).

In conclusion, we summarize the results achieved and draw directions for 
future researches regarding TEE in cloud computing.

\end{abstract}

%----------------------------------------------------------------------------------------
%	Publications
%----------------------------------------------------------------------------------------

\begin{publications}
\addchaptertocentry{\publicationsname} % Add the abstract to the table of contents

\section*{Conference Proceedings}
\begin{itemize}
	
	\item F. Toffalini, J. Zhou, and L. Cavallaro -- Revisiting Program 
	Analysis and Intrusion Detection for SGX -- (under review at CCS 
	2021).\footnote[$\dagger$]{\label{inthesis}These publications are 
	contributions of the thesis.}
	
	\item F. Toffalini, M. Graziano, M. Conti, and J. Zhou -- SnakeGX: a sneaky 
	attack against SGX Enclaves -- In the 19th International Conference on 
	Applied Cryptography and Network Security (ACNS 
	2021). \footnoteref{inthesis}
	
	\item F. Toffalini, E. Losiouk, Biondo A., J. Zhou, and M. Conti -- ScaRR: 
	Scalable Runtime Remote Attestation for Complex Systems -- In the 22nd 
	International Symposium on Research in Attacks, Intrusions and Defenses 
	(RAID 2019). \footnoteref{inthesis}
	
	\item F. Toffalini, M. Ochoa, J. Sun, and J. Zhou -- Careful-Packing: A 
	Practical and Scalable Anti-Tampering Software Protection enforced by 
	Trusted Computing -- In the 9th ACM Conference on Data and Application 
	Security and Privacy (CODASPY 2019). \footnoteref{inthesis}
	
\end{itemize}

\section*{Journal Publications}
\begin{itemize}
	\item F. Toffalini, A. Oliveri, M. Graziano, J. Zhou, and D. Balzarotti -- 
	Following the evidence beyond the wall:	memory forensic in SGX 
	environments -- (under review at FSI Digital 
	Investigation). \footnoteref{inthesis}
	
	\item I. Homoliak, F. Toffalini, J. Guarnizo, Y. Elovici, and M. 
	Ochoa -- Insight Into Insiders and IT: A Survey of Insider Threat 
	Taxonomies, Analysis, Modeling, and Countermeasures -- ACM Computing 
	Surveys (CSUR).
	
\end{itemize}

\section*{Workshop Proceedings}
\begin{itemize}
	
	\item F. Toffalini, I. Homoliak, A. Harilal, A. Binder, and M. Ochoa --  
	Detection of Masqueraders Based on Graph Partitioning of File System 
	Access Events -- In IEEE Security and Privacy Workshops (SPW 2018).
	
	\item A. Harilal, F. Toffalini, J. Castellanos, J. Guarnizo, I. Homoliak,  
	and M. Ochoa -- TWOS: A Dataset of Malicious Insider Threat Behavior Based 
	on a Gamified Competition -- The 9th ACM CCS International Workshop on 
	Managing Insider Security Threats (MIST 2017).	
\end{itemize}


\end{publications}

%----------------------------------------------------------------------------------------
%	ACKNOWLEDGEMENTS
%----------------------------------------------------------------------------------------

\begin{acknowledgements}
\addchaptertocentry{\acknowledgementname} % Add the acknowledgements to the 
%table of contents

I would like to acknowledge the following people for their help and support 
along my PhD journey in Singapore.

In the first place, I want to thank all the supervisors I met in these years. 
Martin for accepting me in SUTD, thus making me start this adventure. 
Then, Mauro, who helped me once I really need, and Jianying for adopting me in 
his group.
Finally, Lorenzo, for his extraordinary teaching and inspirational vision.
I can only hope to grasp a bit of their wisdom.

I also desire to spend few words for my (extended) research group, with whom I 
shared my thoughts, fears, and hopes. Thanks, John, Eric, Juan, Athul, Andrei, 
Mujeeb, Sridhar, and all the inestimable people I came across. 

A special thought to all the enthusiastic collaborators that I had the luck to 
work with outside Singapore: Eleonora, Alessandro, Andrea B., Mariano, Davide, 
Andrea O., Giulio, Jacopo, Fukutomo, Fabio, Feargus, and Zeliang.
Each and every of them envisioned me with a peculiar and unique perspective, 
pushing my limits always a little further.

Outside academia, I feel to tank my friends: Yvonne, Cem, Sakshi, 
Esra, Daniele, Daniel, Francesco, and a long list of people that otherwise
require additional pages.

In the end, I leave the deepest thank to my wife Anna: an inexplicable gem 
that 
enlightened the darkest moments. Finally my parents, Lucia and Lino, without 
them I could not be here now.


\end{acknowledgements}

%----------------------------------------------------------------------------------------
%	LIST OF CONTENTS/FIGURES/TABLES PAGES
%----------------------------------------------------------------------------------------

\tableofcontents % Prints the main table of contents

\listoffigures % Prints the list of figures

\listoftables % Prints the list of tables

%----------------------------------------------------------------------------------------
%	ABBREVIATIONS
%----------------------------------------------------------------------------------------

% Uncomment for abbreviations page
% \begin{abbreviations}{ll} % Include a list of abbreviations (a table of two columns)
%
% \textbf{LAH} & \textbf{L}ist \textbf{A}bbreviations \textbf{H}ere\\
% \textbf{WSF} & \textbf{W}hat (it) \textbf{S}tands \textbf{F}or\\
%
% \end{abbreviations}

%----------------------------------------------------------------------------------------
%	PHYSICAL CONSTANTS/OTHER DEFINITIONS
%----------------------------------------------------------------------------------------

% Uncomment for physical constants etc
% \begin{constants}{lr@{${}={}$}l} % The list of physical constants is a three column table
%
% % The \SI{}{} command is provided by the siunitx package, see its documentation for instructions on how to use it
%
% 	Speed of Light & $c_{0}$ & \SI{2.99792458e8}{\meter\per\second} (exact)\\
% %Constant Name & $Symbol$ & $Constant Value$ with units\\
%
% \end{constants}

%----------------------------------------------------------------------------------------
%	SYMBOLS
%----------------------------------------------------------------------------------------

% Uncomment for symbols
% \begin{symbols}{lll} % Include a list of Symbols (a three column table)
%
% $a$ & distance & \si{\meter} \\
% $P$ & power & \si{\watt} (\si{\joule\per\second}) \\
% %Symbol & Name & Unit \\
%
% \addlinespace % Gap to separate the Roman symbols from the Greek
%
% $\omega$ & angular frequency & \si{\radian} \\
%
% \end{symbols}

%----------------------------------------------------------------------------------------
%	DEDICATION
%----------------------------------------------------------------------------------------

\dedicatory{To the priceless love daily received by my wife Anna, my mum 
Lucia, and my father Lino \dots}

%----------------------------------------------------------------------------------------
%	THESIS CONTENT - CHAPTERS
%----------------------------------------------------------------------------------------

\mainmatter % Begin numeric (1,2,3...) page numbering

\pagestyle{thesis} % Return the page headers back to the "thesis" style

% Include the chapters of the thesis as separate files from the Chapters folder
% Uncomment the lines as you write the chapters

\include{chapters/introduction}
\include{chapters/background-trusting-computing}
\include{chapters/static-protection}
\include{chapters/new-threats}
\include{chapters/forensic-analysis}
\include{chapters/runtime-protection-untrusted}
\include{chapters/runtime-protection-trusted}
\include{chapters/related-works}
\include{chapters/conclusion}

%----------------------------------------------------------------------------------------
%	THESIS CONTENT - APPENDICES
%----------------------------------------------------------------------------------------

\appendix % Cue to tell LaTeX that the following "chapters" are Appendices

% Include the appendices of the thesis as separate files from the Appendices folder
% Uncomment the lines as you write the Appendices

%\include{appendices/appendixA.tex}
%\include{appendices/appendix_snakegx0}
%\include{appendices/appendix_snakegx1}
%\include{appendices/appendix_snakegx2}
\include{appendices/appendix_sgxmonitor}

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------

%\nocite{*}
\printbibliography[heading=bibintoc]

%----------------------------------------------------------------------------------------

\end{document}
